.. _file_menu:

==========
All File Menu Options
==========

The file menu is purely used for Saving and Loading things. Note that saving networks should be done in the network table in the bottom right and not here.

Save
---------
The save menu saves everything to the active directory (as referenced by the command window running the program) using generic names. This can be used for quick saving.

1. 'Save Network 3D Object'
    * Saves all of the active core NetTracer3D properties (see :doc:`properties`) into a new folder called 'my_network'.
2. 'Save Nodes'
    * Saves the nodes channel as 'labelled_nodes.tif'
3. 'Save Edges'
    * Saves the edges channel as 'labelled_edges.tif'
4. 'Save Overlay 1'
    * Saves Overlay 1 as 'overlay_1.tif'
5. 'Save Overlay 2'
    * Saves Overlay 2 as 'overlay_2.tif'
6. 'Save Highlight Overlay'
    * Saves the Highlight Overlay as 'Highlighted_Element.tif'

Save As
---------
The save as menu will prompt the user to name files and select a directory while saving.

1. 'Save Network 3D Object As'
    * Prompt the user to select a folder/directory. Entering nothing will just use the current directory that is displayed in the file search prompt. Once a directory is selected, a new window will appear prompting the user to name the output folder. Next, saves all of the active core NetTracer3D properties (see :doc:`properties`) into the new folder at the specified directory/folder.
2. 'Save Nodes As'
    * Prompts the user to save the nodes channel as a .tif.
3. 'Save Edges As'
    * Prompts the user to save the edges channel as a .tif.
4. 'Save Overlay 1 As'
    * Prompts the user to save the Overlay 1 as a .tif.
5. 'Save Overlay 2 As'
    * Prompts the user to save the Overlay 2 as a .tif.
6. 'Save Highlight Overlay As'
    * Saves the Highlight Overlay as a .tif.

.. _merge_nodes:
Load
---------
The save as menu will prompt the user to find files to load. Note that when it comes to loading images, NetTracer3D does not like loading channels of different dimensions. If the user tries to do this, they will be prompted to have the image be auto-resized to the same dimensions as previous ones that exist in the Image Viewer Window. The user is advised to accept this, but can ignore it at their own risk of crashing the program.

1. 'Load Network 3D Object'
    * Prompts the user to find a folder containing the 'Network 3D object', which is basically a set of files containing saved versions of the core properties that NetTracer3D references. These folders will typically be generated by the 'Save(As) Network3D Object' function. When the Network3D Object is assembling, the program will look for files that have the generic names that were assigned with the 'Save(As) Network3D Object' function (Or the generic Save (Not Save As) options in general). Files under different names will be ignored.
2. 'Load Nodes'
    * Prompts the user to find a .tif/.tiff/.nii/.jpg/.jpeg/.png image to load into the nodes channel. Only supports grayscale (Color images will be converted to grayscale).
3. 'Load Edges'
    * Prompts the user to find a .tif/.tiff/.nii/.jpg/.jpeg/.png image to load into the edges channel. Only supports grayscale (Color images will be converted to grayscale).
4. 'Load Overlay 1'
    * Prompts the user to find a .tif/.tiff/.nii/.jpg/.jpeg/.png image to load into the Overlay 1 channel. Supports color images.
5. 'Load Overlay 2'
    * Prompts the user to find a .tif/.tiff/.nii/.jpg/.jpeg/.png image to load into the Overlay 2 channel. Supports color images.
6. 'Load Network'
    * Prompts the user to find a .csv/.xlsx file containing network data in the structure NetTracer3D expects (that is, the same structure it saves .csv/.xlsx networks as).
7. 'Load From Excel Helper'
    * Opens the excel helper, which is a seperate GUI to open less-structured .csv or .xlsx spreadsheets that the user may have obtained elsewhere, and more easily convert them into NetTracer3D properties. (See :doc:`excel_helper`)
    * As of now, this can be used to load in 'Node Centroids', 'Node Identities', or 'Node Communities'. 
8. 'Load Misc Properties -> Load Node IDs'
    * Prompts the user to find a .csv/.xlsx file containing Node IDs in the structure NetTracer3D expects (that is, the same structure it saves node IDs as).
9. 'Load Misc Properties -> Load Node Centroids'
    * Prompts the user to find a .csv/.xlsx file containing Node Centroids in the structure NetTracer3D expects (that is, the same structure it saves Node Centroids as).
10. 'Load Misc Properties -> Load Edge Centroids'
    * Prompts the user to find a .csv/.xlsx file containing Edge Centroids in the structure NetTracer3D expects (that is, the same structure it saves Edge Centroids as).
11. 'Load Misc Properties -> Load Node Communities
    * Prompts the user to find a .csv/.xlsx file containing network communities in the structure NetTracer3D expects (that is, the same structure it saves communities as).
12. 'Load Misc Properties -> Merge Nodes'
    * Prompts the user to find a .tif/.tiff file corresponding to an additional labeled nodes image they would like to merge with the current nodes channel (Alternatively, the user can select a directory containing a set of .tif/.tiff images if they would like to merge many nodes images at once).
    * The point of this function is to allow nodes from several types of images to be compared, for example, heterogenous structures or cell types.
    * Note that at this point in time, these labels cannot overlap as they are being combined into one image. 
    * Generally one would segment the images and label them individually before trying to merge them.
    * Merging nodes auto-assigns the nodes IDs based on the name of the .tif/.tiff that is being merged, while the original nodes aquire the name 'root_nodes'.
    * These IDs cannot be changed in NetTracer3D. To change them, please save the Node IDs as described above, edit the names directly in a spreadsheet-editing software like Microsoft Excel, then reload the Node IDs with 'Load -> Load Misc Properties -> Load Node IDs'
13. 'Load Misc Properties -> Merge Node IDs From Images'
    * Prompts the user to find a directory containing .tif/.tiff channels corresponding to additional channels from the image that yielded the nodes image.
    * The nodes from the nodes image will be compared to auto-binarized versions of the images in the directory to assess what 'identities' each node has.
    * The point of this is compatibility with something like CODEX. The nodes can be created by segmenting, then watershedding/labeling a nuclei marker such as DAPI. 
    * The node markers can search outwards for overlap (estimating a cell radius) based on a user defined distance (or this can be precomputed in 'Process -> Image -> Dilate').
    * The images in the directory must all be seperated into their own channels of equal dimensions to the nodes channel - no hyperstacks or multi-channel images. They can be pre-binarized, but if not, they will be auto binarized with Otsu's method (which predicts the foreground vs bacgkround).
    * Node markers with positive overlap to each image will aquire the title of that image with a + symbol in its node identities property. Those without it will aquire the title with a - symbol.
    * These identity markers will add to a growing string for each node.
    * At the end, the resultant complete node identities will be shown in the upper right tabulated data widget.
    * For specific phenotype classification, please save the node identities as .csv, then load them with classifiers from the Excel Helper, see: :doc:`excel_helper`
    * Note this functionality exists to enable end-to-end pipelines, but it is also something more focused on in a tool like QuPath, whose .csv outputs can be modularly brought to NetTracer3D with the excel helper.

Next Steps
---------
This concludes the explanations of the right click functions. Next, proceed to :doc:`analyze_menu` for information on the analyze menu functions.