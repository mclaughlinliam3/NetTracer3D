

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Labeling Branches and Branch Networks &mdash; NetTracer3D 1.0.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=71272d9f"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Properties of a Network3D Object" href="properties.html" />
    <link rel="prev" title="Proximity Networks - Ideal for Cellular Data" href="proximity.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            NetTracer3D
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart - Segmenting Data and Generating Connectivity Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="proximity.html">Proximity Networks - Ideal for Cellular Data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Labeling Branches and Branch Networks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#labeling-branches">Labeling Branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples-of-tweaking-branch-labels-optional">Examples of Tweaking Branch Labels (Optional)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#handling-spine-artifacts">Handling spine artifacts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#handling-split-labels">Handling split labels</a></li>
<li class="toctree-l3"><a class="reference internal" href="#with-corrections">With Corrections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#morphological-analysis">Morphological Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#branch-adjacency-network">Branch Adjacency Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-branch-labels-as-nodes">Using Branch Labels as Nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#branchpoint-networks">Branchpoint Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="properties.html">Properties of a Network3D Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="excel_helper.html">Using the Spreadsheet Loader</a></li>
<li class="toctree-l1"><a class="reference internal" href="keyboard_shortcuts.html">Available Keyboard Shortcuts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Detailed Function Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="right_clicking.html">Right Clicking - All Options Available by Right Clicking in the GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="file_menu.html">All File Menu Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="analyze_menu.html">All Analyze Menu Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="process_menu.html">All Process Menu Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_menu.html">All Image Menu Options</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Road Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NetTracer3D</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Labeling Branches and Branch Networks</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/branches.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="labeling-branches-and-branch-networks">
<span id="branches"></span><h1>Labeling Branches and Branch Networks<a class="headerlink" href="#labeling-branches-and-branch-networks" title="Link to this heading"></a></h1>
<section id="labeling-branches">
<h2>Labeling Branches<a class="headerlink" href="#labeling-branches" title="Link to this heading"></a></h2>
<p>To demonstrate branch labeling, I will use a cartoon depiction of a neuron.</p>
<a class="reference internal image-reference" href="_images/branch0.png"><img alt="Neuron" src="_images/branch0.png" style="width: 500px;" />
</a>
<ol class="arabic simple">
<li><p>First, I load my image into the nodes channel and segment the image into a binary mask with the ML-segmenter.</p></li>
<li><p>Next, I save the binary mask and reload it into the edges channel. The edges channel is the staging channel for all branch labeling.</p></li>
<li><p>Next, I run ‘Process -&gt; Generate -&gt; Label Branches’</p></li>
<li><p>I am prompted by a window and select ‘Run Branch Label’ to use the default settings. I am prompted by a second window and select ‘Run Node Generation’ to use its default settings (this is a sub-algorithm that the former uses).</p></li>
</ol>
<p>With these default settings, my labeled branches look like this:</p>
<a class="reference internal image-reference" href="_images/branch1.png"><img alt="Neuron default" src="_images/branch1.png" style="width: 500px;" />
</a>
<p><em>Note branch labeling will put a grayscale value into your edges channel. I generated this colorful one for visualization using ‘Image -&gt; Overlays -&gt; Color Nodes (or Edges)’</em></p>
<p>We can see this image has succesfully identified the majority of the branches here. In many cases, a labeling schematic like this will be sufficient and we can proceed.</p>
</section>
<section id="examples-of-tweaking-branch-labels-optional">
<h2>Examples of Tweaking Branch Labels (Optional)<a class="headerlink" href="#examples-of-tweaking-branch-labels-optional" title="Link to this heading"></a></h2>
<p>However, in this instance, there are few areas that may be worth addressing for a more accurate labeling.</p>
<ul class="simple">
<li><p>Mainly, that there are little branches at the end of some of the dendrites that do not belong there. (In this case, this is due to segmentation artifacts making the edges appear to have really small branches).</p></li>
</ul>
<p>Luckily NetTracer3D’s branch labelling algorithm has a good variety of auto-correcting tools when labeling branches. Here are a few that are enabled by default that I generally recommend:</p>
<ol class="arabic simple">
<li><p>By default, ‘Auto-Correct 2’ is enabled in the branch labeler. This option collapses any internal labels and forces them to merge with neighbors bordering the background. Otherwise, the middle of the neuron here (the soma) would likely have obtained a mosaic-looking set of labels.</p></li>
<li><p>For 3D images, ‘Attempt to Auto-Correct Skeleton Looping’ is auto-enabled. This option attempts to convert any polyp-looking artifacts that show up in the internal skeletonization step back to single filaments (generally recommend).</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>However, this is not enabled for 2D, so my neuron did not use it. Mainly this is because in 2D, it cannot tell the difference between an artifactual and a real loop, but in this case we don’t have any real loops so we’ll use it.</p></li>
</ul>
</div></blockquote>
<section id="handling-spine-artifacts">
<h3>Handling spine artifacts<a class="headerlink" href="#handling-spine-artifacts" title="Link to this heading"></a></h3>
<p>Reloading my binary image of a neuron into edges, I once more run the branch labeler. I would like to avoid those small, wrongly labeled terminal branches from slipping through.
To do this, I want to decide what length of spine to remove from the image skeleton (which is used to label branches). This choice can be informed by skeletonizing my image with ‘Process -&gt; Image -&gt; Skeletonize’, then measuring the length of these terminal branches by right-clicking in the Image Viewer Window and placing measurement points:</p>
<a class="reference internal image-reference" href="_images/branch2.png"><img alt="Measuring Spines" src="_images/branch2.png" style="width: 500px;" />
</a>
<p><em>Here we are at the end of a dendrite. We can see that the skeleton has incorrectly split - this is the source of those little branches. Use direct measurement for an accurate estimate of what spine lengths to remove</em></p>
<p>when prompted with the second menu, I enable a new optional setting:</p>
<a class="reference internal image-reference" href="_images/branch4.png"><img alt="Branch Grouped" src="_images/branch4.png" style="width: 500px;" />
</a>
<p><em>Here, I set ‘Skeleton Branch Length to Remove’ to ‘8’</em></p>
<p>Now when I run my labeler, it ignores all <em>terminal</em> branches below that length. Note this algorithm will only remove branches starting from an endpoint, until reaching a parent branch. Therefore, more internal branches that do not have endpoints themselves are always safe from removal, allowing us to use larger numbers without risk of major changes to the image.</p>
</section>
<section id="handling-split-labels">
<h3>Handling split labels<a class="headerlink" href="#handling-split-labels" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Depending on the the structure of the branched image, rarely certain branches may inherit the label of a nearby branch, if they are far away from the internal filament (skeleton) of their own branch and the adjacent branch is much smaller.</p></li>
<li><p>This issue does not apply here, but to address it, I could enable the ‘Split Non-Touching Branches’ correction option, which is relevant mainly for ‘Branch Adjacency Networks’, but generally not recommended if running purely morphological analysis.</p></li>
</ul>
</section>
<section id="with-corrections">
<h3>With Corrections<a class="headerlink" href="#with-corrections" title="Link to this heading"></a></h3>
<p>Our final branch labeled neuron looks like this:</p>
<a class="reference internal image-reference" href="_images/branch6.png"><img alt="Branch Final" src="_images/branch6.png" style="width: 500px;" />
</a>
<p><em>Branches smaller than 8 voxels long have joined their neighbors</em></p>
</section>
<section id="morphological-analysis">
<h3>Morphological Analysis<a class="headerlink" href="#morphological-analysis" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Beyond just networks, NetTracer3D offers a suite of options for morphological and/or spatial analysis that doesn’t even pertain to the network itself.</p></li>
<li><p>For example here, I use ‘Analyze -&gt; Stats -&gt; Calculate Radii’, then use the radii table to threshold my branches by radius, shown below.</p></li>
<li><p>Any calculation done on the nodes can be used to threshold the nodes from the table, generally speaking, which makes NetTracer3D very useful at tying analytics back into spatial analysis.</p></li>
</ul>
<a class="reference internal image-reference" href="_images/radii_thresh.png"><img alt="radii_thresh" src="_images/radii_thresh.png" style="width: 800px;" />
</a>
<p><a href="#id1"><span class="problematic" id="id2">*</span></a>Note that thresholding with the tables always applies on the nodes, but labelling branches puts them in the edges channel by default sometimes. You can use ‘Image -&gt; Overlays -&gt; Shuffle’ to move images around to where you want them.</p>
</section>
</section>
<section id="branch-adjacency-network">
<h2>Branch Adjacency Network<a class="headerlink" href="#branch-adjacency-network" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>The simplest way to create a branch adjacency network is to run ‘Process -&gt; Calculate Network -&gt; Calculate Branch Adjacency Network (of edges)’</p></li>
<li><p>This can be run on a binary image in the ‘edges’ channel.</p></li>
<li><p>It simply labels the branches with the same options as above, then calls the proximity network to find neighbors a distance of 1 voxel away.</p></li>
<li><p>Of course, it could also be accomplished by labeling the branches, moving them to the nodes channel, and manually running a proximity network.</p></li>
</ul>
<a class="reference internal image-reference" href="_images/branch7.png"><img alt="Branch Network" src="_images/branch7.png" style="width: 500px;" />
</a>
<p><em>Using networks, we have abstracted down the image of this neuron into a very simple data structure</em></p>
</section>
<section id="using-branch-labels-as-nodes">
<h2>Using Branch Labels as Nodes<a class="headerlink" href="#using-branch-labels-as-nodes" title="Link to this heading"></a></h2>
<p>One interesting use of branch labeling is its ability to ‘node-ify’ structures that are otherwise not seperable into discrete regions. Once we label an image’s branches, we can use those as nodes to generate a connectivity network.
For example, in the below image, I label the bronchi on this 3D image of a mouse lung to see how they are innervated by a set of nearby nerves:</p>
<a class="reference internal image-reference" href="_images/branch8.png"><img alt="Bronchi Image" src="_images/branch8.png" style="width: 500px;" />
</a>
<p><em>This dataset was shared by Rebecca Salamon from UC San Diego. Please use ‘Image -&gt; Show 3D’ to call a Napari window that will automatically load active NetTracer3D datasets for 3D visualization.</em></p>
<a class="reference internal image-reference" href="_images/branch9.png"><img alt="Bronchi Render" src="_images/branch9.png" style="width: 500px;" />
</a>
<p><em>Same image but with the alogrithmically-derived branches displayed. Using branch labeling, we can split up biological objects into meaningful domains</em></p>
<a class="reference internal image-reference" href="_images/branch10.png"><img alt="Bronchi Network" src="_images/branch10.png" style="width: 500px;" />
</a>
<p><em>And of course, the network itself</em></p>
</section>
<section id="branchpoint-networks">
<span id="branchpoint"></span><h2>Branchpoint Networks<a class="headerlink" href="#branchpoint-networks" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Another option for creating networks from branched objects is connecting the branchpoints rather than the branches themselves. To accomplish this, the easiest way is to run ‘Process -&gt; Calculate Network -&gt; Calculate Branchpoint Network’</p></li>
<li><p>This can be run on a binary image in the ‘edges’ channel.</p></li>
<li><p>It simply assign nodes to branchpoints using the ‘Process -&gt; Generate -&gt; Generate4 Nodes From Edge Vertices’ option, then assigns neighbors based on which edges interact with which node.</p></li>
<li><p>Although not <em>exactly</em> the same, this can be accomplished by running the aforementioned methods to generate the nodes, then manually linking them with a connectivity network. (But note that if done this way, some level of node-search is required, which would probably be slower).</p></li>
</ul>
<p>In the below example, I segment, then create a branchpoint network from a 3D image of lymph nodes.</p>
<a class="reference internal image-reference" href="_images/lymph1.png"><img alt="Lymph" src="_images/lymph1.png" style="width: 500px;" />
</a>
<p><em>The raw image (background masked). This original image was downloaded from the HuBMAP portal from an image captured by the University of Florida TMC</em></p>
<a class="reference internal image-reference" href="_images/lymph2.png"><img alt="Lymph Network" src="_images/lymph2.png" style="width: 500px;" />
</a>
<p><em>Same image with its network overlay superimposed</em></p>
<a class="reference internal image-reference" href="_images/lymph3.png"><img alt="Lymph Render" src="_images/lymph3.png" style="width: 500px;" />
</a>
<p><em>Not related to the network, but here are its labeled branches</em></p>
<p>Labeling branchpoint networks is an additional way to explore networks of branched objects. Branchpoint networks, for example, show the discrete connections between branches better than branch adjacency networks. However they come with the downside of not being able to access some of the higher level branch-editing options, such as the auto-correction based on grouping.</p>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading"></a></h2>
<p>Next, you may want to read <a class="reference internal" href="properties.html"><span class="doc">Properties of a Network3D Object</span></a> to learn about what information is saved and loaded in Network3D Objects.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="proximity.html" class="btn btn-neutral float-left" title="Proximity Networks - Ideal for Cellular Data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="properties.html" class="btn btn-neutral float-right" title="Properties of a Network3D Object" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Liam McLaughlin.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>