

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Labeling Branches and Branch Networks &mdash; NetTracer3D 0.7.8 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=ddeecabf"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Properties of a Network3D Object" href="properties.html" />
    <link rel="prev" title="Quickstart - Segmenting Data and Generating Networks" href="quickstart.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            NetTracer3D
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart - Segmenting Data and Generating Networks</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Labeling Branches and Branch Networks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#labeling-branches">Labeling Branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples-of-tweaking-branch-labels-optional">Examples of Tweaking Branch Labels (Optional)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#handling-over-labeled-globs">Handling over-labeled globs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#handling-spine-artifacts">Handling spine artifacts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#handling-split-labels">Handling split labels</a></li>
<li class="toctree-l3"><a class="reference internal" href="#putting-it-all-together">Putting it all together</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#branch-adjacency-network">Branch Adjacency Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-branch-labels-as-nodes">Using Branch Labels as Nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#branchpoint-networks">Branchpoint Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="properties.html">Properties of a Network3D Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="excel_helper.html">Using the Spreadsheet Loader</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Detailed Function Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="right_clicking.html">Right Clicking - All Options Available by Right Clicking in the GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="file_menu.html">All File Menu Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="analyze_menu.html">All Analyze Menu Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="process_menu.html">All Process Menu Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="image_menu.html">All Image Menu Options</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Road Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NetTracer3D</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Labeling Branches and Branch Networks</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/branches.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="labeling-branches-and-branch-networks">
<span id="branches"></span><h1>Labeling Branches and Branch Networks<a class="headerlink" href="#labeling-branches-and-branch-networks" title="Link to this heading"></a></h1>
<section id="labeling-branches">
<h2>Labeling Branches<a class="headerlink" href="#labeling-branches" title="Link to this heading"></a></h2>
<p>To demonstrate branch labeling, I will use a cartoon depiction of a neuron.</p>
<a class="reference internal image-reference" href="_images/branch0.png"><img alt="Neuron" src="_images/branch0.png" style="width: 500px;" />
</a>
<ol class="arabic simple">
<li><p>First, I load my image into the nodes channel and segment the image into a binary mask with the ML-segmenter.</p></li>
<li><p>Next, I save the binary mask and reload it into the edges channel. The edges channel is the staging channel for all branch labeling.</p></li>
<li><p>Next, I run ‘Process -&gt; Generate -&gt; Label Branches’</p></li>
<li><p>I am prompted by a window and select ‘Run Branch Label’ to use the default settings. I am prompted by a second window and select ‘Run Node Generation’ to use its default settings (this is a sub-algorithm that the former uses).</p></li>
</ol>
<p>With these default settings, my labeled branches look like this:</p>
<a class="reference internal image-reference" href="_images/branch1.png"><img alt="Neuron default" src="_images/branch1.png" style="width: 500px;" />
</a>
<p><em>Note branch labeling will put a grayscale value into your edges channel. I generated this colorful one for visualization using ‘Image -&gt; Overlays -&gt; Color Nodes (or Edges)’</em></p>
<p>We can see this image has succesfully identified the majority of the branches here. In many cases, a labeling schematic like this will be sufficient and we can proceed.</p>
</section>
<section id="examples-of-tweaking-branch-labels-optional">
<h2>Examples of Tweaking Branch Labels (Optional)<a class="headerlink" href="#examples-of-tweaking-branch-labels-optional" title="Link to this heading"></a></h2>
<p>However, in this instance, there are several areas that may be worth addressing for a more accurate labeling, which I will discuss below:
There are three issues I will address:</p>
<ol class="arabic simple">
<li><p>The body of the neuron has been divided into a plethora of branches. (The algorithm optimally handles branch-structures and tends to get confused over bulbous ones).</p></li>
<li><p>There are little branches at the end of some of the dendrites that do not belong there. (In this case, this is due to segmentation artifacts not fully fusing the ends of the dendrites in the segmentation).</p></li>
<li><p>Some branches share a label. (This can occur due to how this algorithm works at a fundamental level [although it can be addressed in post] because the system is <em>guessing</em> so to speak what constitutes a unique branch. See the section on this algorithm for more information.)</p></li>
</ol>
<p>Luckily NetTracer3D offers a suite of tools for improving segmentations in post.</p>
<section id="handling-over-labeled-globs">
<h3>Handling over-labeled globs<a class="headerlink" href="#handling-over-labeled-globs" title="Link to this heading"></a></h3>
<p>To address the first one, I save my labeled branches and redo the branch labeling algorithm:</p>
<a class="reference internal image-reference" href="_images/branch3.png"><img alt="Branch Label Menu" src="_images/branch3.png" style="width: 500px;" />
</a>
<p>This time instead of using the default settings, I enable ‘auto correct branches’ and set its corresponding value below from 4 to 2 (2 just happened to do what I needed in my testing).
This enables an optional sub-algorithm that evaluates groups of branches and decides if it should collapse over-abundant regions into a single branch.
When I run the labeler with the new settings, I get this image:</p>
<a class="reference internal image-reference" href="_images/branch5.png"><img alt="Branch Grouped" src="_images/branch5.png" style="width: 500px;" />
</a>
<p>As we can see, this time it grouped branches together into much larger branches, and correctly identified the soma.
But we’ll assume that what I want is the abundance of branches in the first image, together with the soma.
We’ll save this new, broadly labeled branch image and set it aside while we return to the original labeling strategy.</p>
</section>
<section id="handling-spine-artifacts">
<h3>Handling spine artifacts<a class="headerlink" href="#handling-spine-artifacts" title="Link to this heading"></a></h3>
<p>Reloading my binary image of a neuron into edges, I once more run the branch labeler, this time not enabling ‘auto correct branches’. However, recalling my second issue, I would like to avoid those small, wrongly labeled terminal branches from slipping through.
To do this, I want to decide what length of spine to remove from the image skeleton (which is used to label branches). This choice can be informed by skeletonizing my image with ‘Process -&gt; Image -&gt; Skeletonize’, then measuring the length of these terminal branches by right-clicking in the Image Viewer Window and placing measurement points:</p>
<a class="reference internal image-reference" href="_images/branch2.png"><img alt="Measuring Spines" src="_images/branch2.png" style="width: 500px;" />
</a>
<p><em>Here we are at the end of a dendrite. We can see that the skeleton has incorrectly split - this is the source of those little branches. Use direct measurement for an accurate estimate of what spine lengths to remove</em></p>
<p>when prompted with the second menu, I enable a new optional setting:</p>
<a class="reference internal image-reference" href="_images/branch4.png"><img alt="Branch Grouped" src="_images/branch4.png" style="width: 500px;" />
</a>
<p><em>Here, I set ‘Skeleton Branch Length to Remove’ to ‘8’</em></p>
<p>Now when I run my labeler, it ignores all <em>terminal</em> branches below that length. Note this algorithm will only remove branches starting from an endpoint, until reaching a parent branch. Therefore, more internal branches that do not have endpoints themselves are always safe from removal, allowing us to use larger numbers without risk of major changes to the image.</p>
</section>
<section id="handling-split-labels">
<h3>Handling split labels<a class="headerlink" href="#handling-split-labels" title="Link to this heading"></a></h3>
<p>In the labeled output placed in the segmentation channel, I also want to address issue 3. To do this, I right click the image and choose ‘Select All -&gt; Edges’. Once everything is higlighted, I right click again and choose ‘Selection -&gt; Split non touching labels’.
This causes all non-touching labels to take on unique identities, handling issue 3.</p>
</section>
<section id="putting-it-all-together">
<h3>Putting it all together<a class="headerlink" href="#putting-it-all-together" title="Link to this heading"></a></h3>
<p>Finally, to get the large soma label into this new many-branch image, I load the broadly labeled branch image (generated above) back into the nodes channel. With ‘nodes’ as my ‘active image’, I click on the soma to select it. Finally, I choose ‘Selection -&gt; Override Channel with Selection’.
In the window that appears, I tell it to use my nodes selected region (from the nodes channel) to override my edges channel (selecting to place the output in the edges channel). This takes the labels from my nodes channel in the highlighted region, transposes them to not overlap with current labels in my edges channel, and stamps that region into my edges channel, effectively moving the soma label while keeping the rest of the branch labels.
Our final branch labeled neuron looks like this:</p>
<a class="reference internal image-reference" href="_images/branch6.png"><img alt="Branch Final" src="_images/branch6.png" style="width: 500px;" />
</a>
<p>Although we could have grouped the soma manually, I demonstrated this algorithmically to show how this could be scaled up. If we were labeling many neurons and wanted each to look like this, the above steps will allow us to do it without rote selection (only, you would use the volume-based thresholder to select the somas).</p>
</section>
</section>
<section id="branch-adjacency-network">
<h2>Branch Adjacency Network<a class="headerlink" href="#branch-adjacency-network" title="Link to this heading"></a></h2>
<p>To create a network showing adjacent branches, first move the labeled branches into the nodes channel (either by saving and reloading it, or with ‘Image -&gt; Overlays -&gt; Shuffle’).
Using the branches as nodes, create a proximity network using ‘Process -&gt; Calculate -&gt; Calculate Proximity Network’, using 1 voxel as the search param and searching from morphological shape rather than centroids. This will result in the generation of a network showing adjacent branches. The final product is shown below:</p>
<a class="reference internal image-reference" href="_images/branch7.png"><img alt="Branch Network" src="_images/branch7.png" style="width: 500px;" />
</a>
<p><em>Using networks, we have abstracted down the image of this neuron into a very simple data structure</em></p>
</section>
<section id="using-branch-labels-as-nodes">
<h2>Using Branch Labels as Nodes<a class="headerlink" href="#using-branch-labels-as-nodes" title="Link to this heading"></a></h2>
<p>One interesting use of branch labeling is its ability to ‘node-ify’ structures that are otherwise not seperable into discrete regions. Once we label an image’s branches, we can use those as nodes to generate a connectivity network.
For example, in the below image, I label the bronchi on this 3D image of a mouse lung to see how they are innervated by a set of nearby nerves:</p>
<a class="reference internal image-reference" href="_images/branch8.png"><img alt="Bronchi Image" src="_images/branch8.png" style="width: 500px;" />
</a>
<p><em>This lovely dataset was provided by Rebecca Salamon from UC San Diego. Please use ‘Image -&gt; Show 3D’ to call a Napari window that will automatically load active NetTracer3D datasets for 3D visualization.</em></p>
<a class="reference internal image-reference" href="_images/branch9.png"><img alt="Bronchi Render" src="_images/branch9.png" style="width: 500px;" />
</a>
<p><em>Same image but with the alogrithmically-derived branches displayed. Using branch labeling, we can split up biological objects into meaningful domains</em></p>
<a class="reference internal image-reference" href="_images/branch10.png"><img alt="Bronchi Network" src="_images/branch10.png" style="width: 500px;" />
</a>
<p><em>And of course, the network itself</em></p>
</section>
<section id="branchpoint-networks">
<span id="branchpoint"></span><h2>Branchpoint Networks<a class="headerlink" href="#branchpoint-networks" title="Link to this heading"></a></h2>
<p>Another option for creating networks from branched objects is connecting the branchpoints rather than the branches themselves. To accomplish this, load your branchy image into edges and select ‘Process -&gt; Generate -&gt; Generate Nodes from Edge Vertices’.
You will be prompted by the same window that appears second in the branch-labeler algorithm. This is because the branch labeler actually uses the gennodes algorithm as an internal step, but executing it alone will give us nodes at branchpoints of the image skeleton without proceeding to the labeling step.
We can then use that set of branchpoint nodes together with the image skeleton (which gennodes will transform your edges into) to create a connectivity network.
Simply use ‘Process -&gt; Calculate -&gt; Calculate Connectivity Network’ after gennodes is finished. In the set of params that appear, <strong>set ‘Node Search’ parameter to 2</strong>. You must do this for accurate results, as this algorithm must dilate your edges a single time to see what neighbors they overlap with, and if your node vertices are too small, the edges will pass over that node and create a hub rather than a simple connection.
In the below example, I segment, then create a branchpoint network from a 3D image of lymph nodes.</p>
<a class="reference internal image-reference" href="_images/lymph1.png"><img alt="Lymph" src="_images/lymph1.png" style="width: 500px;" />
</a>
<p><em>The raw image (background masked). This original image was downloaded from the HuBMAP portal from an image captured by the University of Florida TMC</em></p>
<a class="reference internal image-reference" href="_images/lymph2.png"><img alt="Lymph Network" src="_images/lymph2.png" style="width: 500px;" />
</a>
<p><em>Same image with its network overlay superimposed</em></p>
<a class="reference internal image-reference" href="_images/lymph3.png"><img alt="Lymph Render" src="_images/lymph3.png" style="width: 500px;" />
</a>
<p><em>Not related to the network, but here are its labeled branches</em></p>
<p>Labeling branchpoint networks is an additional way to explore networks of branched objects. Branchpoint networks, for example, show the discrete connections between branches better than branch adjacency networks. However they come with the downside of not being able to access some of the higher level branch-editing options, such as the auto-correction based on grouping.</p>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading"></a></h2>
<p>Next, you may want to read <a class="reference internal" href="properties.html"><span class="doc">Properties of a Network3D Object</span></a> to learn about what information is saved and loaded in Network3D Objects.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Quickstart - Segmenting Data and Generating Networks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="properties.html" class="btn btn-neutral float-right" title="Properties of a Network3D Object" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Liam McLaughlin.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>